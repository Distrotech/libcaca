#!/bin/sh

#
# Check that we have no tabs or trailing spaces in the source code
#
failure=0
for dir in caca kernel src cxx examples ruby tools; do
  pushd ../$dir >/dev/null
  for x in $(make -s echo-sources); do
    case "$x" in
     *.c|*.cpp|*.h|*.m) ;;
     *) continue ;;
    esac
    if grep '[[:space:]]$' "$x" >/dev/null 2>&1; then
      echo "error: $dir/$x contains trailing spaces"
      failure=1
    fi
    if grep '	' "$x" >/dev/null 2>&1; then
      echo "error: $dir/$x contains tabs"
      failure=1
    fi
  done
  popd >/dev/null
done

if test "$failure" != "0"; then
  exit 1
fi

echo "0 errors in source code"
exit 0

